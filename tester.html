<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Tester API Gateway</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            padding: 2rem;
        }

        textarea {
            font-family: monospace;
        }
    </style>
</head>

<body>

    <div class="container">
        <h2 class="mb-4">Tester API Gateway</h2>

        <div class="mb-3">
            <label class="form-label">Módulo</label>
            <select id="modulo" class="form-select" onchange="cargarEjemplo()">
                <option value="cliente">Cliente</option>
                <option value="cuenta">Cuenta</option>
                <option value="prestamo">Prestamo</option>
                <option value="tarjeta">Tarjeta de Crédito</option>
                <option value="transaccion">Transacción</option>
                <option value="sucursal">Sucursal</option>
                <option value="empleado">Empleado</option>
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">Acción</label>
            <select id="accion" class="form-select">
                <option value="listar">Listar</option>
                <option value="crear">Crear</option>
                <option value="actualizar">Actualizar</option>
                <option value="eliminar">Eliminar</option>
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">Rol</label>
            <select id="rol" class="form-select">
                <option value="admin_token">Administrador</option>
                <option value="dev_token">Desarrollador</option>
                <option value="sup_token">Supervisor</option>
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">Datos JSON (para crear, actualizar o eliminar)</label>
            <textarea id="datos" class="form-control" rows="8">{}</textarea>
        </div>

        <button onclick="probarAPI()" class="btn btn-success">Probar</button>

        <hr>

        <h5>Resultado:</h5>
        <pre id="resultado" class="bg-white border p-3"></pre>
    </div>

    <script>
        function cargarEjemplo() {
            const modulo = document.getElementById("modulo").value;
            let ejemplo = "{}";

            switch (modulo) {
                case "cliente":
                    ejemplo = JSON.stringify({
                        nombre: "Julito",
                        direccion: "Quito",
                        telefono: "0999999999",
                        email: "julito@correo.com"
                    }, null, 2);
                    break;
                case "cuenta":
                    ejemplo = JSON.stringify({
                        numero_cuenta: "1234567890",
                        tipo: "Ahorros",
                        saldo: 1000.00,
                        id_cliente: 1,
                        id_sucursal: 1
                    }, null, 2);
                    break;
                case "prestamo":
                    ejemplo = JSON.stringify({
                        monto: 5000,
                        interes: 10,
                        plazo: 12,
                        id_cliente: 1,
                        id_sucursal: 1
                    }, null, 2);
                    break;
                case "tarjeta":
                    ejemplo = JSON.stringify({
                        numero_tarjeta: "4111111111111111",
                        tipo: "Visa",
                        limite_credito: 2000.00,
                        id_cuenta: 1
                    }, null, 2);
                    break;
                case "transaccion":
                    ejemplo = JSON.stringify({
                        tipo: "Depósito",
                        monto: 250.00,
                        descripcion: "Depósito en ventanilla",
                        id_cuenta: 1
                    }, null, 2);
                    break;
                case "sucursal":
                    ejemplo = JSON.stringify({
                        nombre: "Sucursal Norte",
                        direccion: "Av. Amazonas"
                    }, null, 2);
                    break;
                case "empleado":
                    ejemplo = JSON.stringify({
                        nombre: "Carlos Ruiz",
                        puesto: "Cajero",
                        telefono: "0988888888",
                        email: "cruiz@banco.com",
                        id_sucursal: 1
                    }, null, 2);
                    break;
            }

            document.getElementById("datos").value = ejemplo;
        }

        async function probarAPI() {
            const modulo = document.getElementById("modulo").value;
            const accion = document.getElementById("accion").value;
            const datos = document.getElementById("datos").value;
            const token = document.getElementById("rol").value;

            const url = `http://localhost/base_k/api.php?modulo=${modulo}&accion=${accion}&token=${token}`;
            let opciones = { method: "GET" };

            if (accion === "crear") {
                opciones = {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: datos
                };
            } else if (accion === "actualizar") {
                opciones = {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: datos
                };
            } else if (accion === "eliminar") {
                opciones = {
                    method: "DELETE",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: datos
                };
            }

            try {
                const res = await fetch(url, opciones);
                const json = await res.json();
                document.getElementById("resultado").textContent = JSON.stringify(json, null, 2);
            } catch (error) {
                document.getElementById("resultado").textContent = "Error al conectarse con la API";
                console.error(error);
            }
        }

        // Cargar ejemplo inicial
        cargarEjemplo();
    </script>

</body>

</html>